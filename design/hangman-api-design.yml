openapi: "3.0.3"
info:
  title: Hangman Backend API
  version: "1.0.1"
  description: |
    RESTful API for Hangman game user management.

    ## Authentication
    All endpoints require JWT Bearer token in Authorization header when authentication is required:
    ```
    Authorization: Bearer <your-jwt-token>
    ```

    ## Rate Limiting
    Different endpoints have different rate limits per minute:
    - **Strict operations** (DELETE): 10 requests/minute
    - **Gameplay operations**: 60 requests/minute
    - **Read operations** (GET): 300 requests/minute
    - **Write operations** (PATCH): 60 requests/minute

    When rate limit is exceeded, API returns 429 status code.

    ## Soft Delete
    Deleted profiles return 404 but data is retained with `deleted_at` timestamp.
    Valid JWT tokens remain active after profile deletion.

servers:
  - url: https://localhost:5000/

#                                         COMPONENTS
components:
  # ========= Security Schema =========
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  # ========= Responses =========
  responses:
    Unauthorized:
      description: Authentication failed/required
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            code: "UNAUTHORIZED"
            message: "Invalid or expired authentication token"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            code: "NOT_FOUND"
            message: "The requested resource does not exist or has been deleted"

    TooManyRequests:
      description: Too many requests
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            code: "RATE_LIMIT_EXCEEDED"
            message: "Too many requests. Please try again in 60 seconds"

    BadRequest:
      description: Invalid request data
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            code: "VALIDATION_ERROR"
            message: "Invalid input data"

  # ========= Other Schemas =========
  schemas:
    # --------- Variable Types  ---------
    ID:
      type: string
      format: uuid
      description: UUID v4 format for Supabase primary keys
      example: "550e8400-e29b-41d4-a716-446655440000"
    Username:
      type: string
      description: Display name
      minLength: 3
      maxLength: 30
      pattern: "^[a-zA-Z0-9_-]+$"
      example: "player_12345"
    Pfp:
      type: string
      format: uri
      description: Profile picture URL
      maxLength: 2048
      example: "https://xsyzxrwyabxqsgjyhult.supabase.co/storage/v1/object/public/profile_pictures/default.png"
    DateTime:
      type: string
      format: date-time
      example: "2026-01-05T10:30:00Z"
    Words:
      type: array
      description: Formatting of a word that's allowed to be stored in a wordlist
      items:
        type: string
        minLength: 2
        maxLength: 250
        pattern: "^[A-Za-z][a-z]*([- ][A-Za-z][a-z]*)*$"
        example: "My Word"

        # --------- Route Schemas ---------
    Me:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        role:
          type: string
          enum: ["authenticated", "anon"]
          example: "authenticated"

    # Seperate Private and Public profiles, to hide email addresses publicly
    PrivateProfile:
      type: object
      required:
        - id
        - email
        - username
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        username:
          $ref: "#/components/schemas/Username"
        pfp:
          $ref: "#/components/schemas/Pfp"
        status:
          type: string
          example: "online"
        created_at:
          description: Profile creation timestamp
          $ref: "#/components/schemas/DateTime"

    PublicProfile:
      type: object
      required:
        - id
        - username
      properties:
        id:
          $ref: "#/components/schemas/ID"
        username:
          $ref: "#/components/schemas/Username"
        pfp:
          $ref: "#/components/schemas/Pfp"
        status:
          type: string
          example: "online"
        created_at:
          description: Profile creation timestamp
          $ref: "#/components/schemas/DateTime"

    ProfileWithStats:
      allOf:
        - $ref: "#/components/schemas/PublicProfile"
        - type: object
          required:
            - stats
          properties:
            multiplayer_stats:
              type: object
              required:
                - games_lost
                - games_won
                - games_played
              properties:
                games_played:
                  type: integer
                  example: 24
                games_won:
                  type: integer
                  example: 12
                games_lost:
                  type: integer
                  example: 12
    Wordlist:
      type: object
      description: Wordlists for a game
      required:
        - id
        - owner_id
        - name
        - words
        - created_at
        - is_public
      properties:
        id:
          $ref: "#/components/schemas/ID"
        owner_id:
          $ref: "#/components/schemas/ID"
        name:
          type: string
          example: "@3.,wordlist"
        words:
          $ref: "#/components/schemas/Words"
        created_at:
          description: Wordlist creation date
          $ref: "#/components/schemas/DateTime"
        updated_at:
          description: When was the wordlist last updated
          $ref: "#/components/schemas/DateTime"
        is_public:
          type: boolean

    Request:
      type: object
      description: A friend request sent to another user
      required:
        - id
        - requester_id
        - addressee_id
        - status
        - requested_at
      properties:
        id:
          $ref: "#/components/schemas/ID"
        requester_id:
          $ref: "#/components/schemas/ID"
        addressee_id:
          $ref: "#/components/schemas/ID"
        status:
          type: string
          enum: ["pending", "accepted", "rejected"]
        requested_at:
          description: Date when relation was requested
          $ref: "#/components/schemas/DateTime"
        accepted_at:
          description: Date when relation was established
          $ref: "#/components/schemas/DateTime"

    Error:
      type: object
      description: Standard Error Response
      required:
        - code
        - message
      properties:
        code:
          type: string
          example: "VALIDATION_ERROR"
        message:
          type: string
          example: "Invalid input data provided"

#                                         PATHS
paths:
  # ========= Me Path =========
  /me:
    get:
      summary: Get current authenticated user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Authenticated user identity
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Me"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  # ========= Profile Path (Session User) =========
  /profile:
    get:
      summary: View profile of the authenticated user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Profile fetched successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PrivateProfile"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "429":
          $ref: "#/components/responses/TooManyRequests"
    patch:
      summary: Update authenticated user profile
      security:
        - bearerAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  $ref: "#/components/schemas/Username"
                pfp:
                  $ref: "#/components/schemas/Pfp"
                status:
                  type: string
      responses:
        "200":
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PrivateProfile"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Conflict - username already taken
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "429":
          $ref: "#/components/responses/TooManyRequests"
    delete:
      summary: Delete authenticated user profile
      security:
        - bearerAuth: []
      responses:
        "204":
          description: Profile deleted successfully
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  # ========= Profiles path (for other users) =========
  /profiles/search:
    get:
      summary: "Search for a specific user profile/username"
      parameters:
        - name: q
          in: query
          required: true
          description: Search query
          schema:
            $ref: "#/components/schemas/Username"
        - name: limit
          in: query
          description: Maximum number of results to return
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
          example: 10
        - name: page
          in: query
          description: Get the page to return
          schema:
            type: integer
            minimum: 1
            default: 1
          example: 2

      responses:
        "200":
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  results:
                    type: array
                    items:
                      $ref: "#/components/schemas/PublicProfile"

        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "429":
          $ref: "#/components/responses/TooManyRequests"
  /profiles/exists:
    get:
      summary: "Quick check for if a username exists or not"
      parameters:
        - name: username
          in: query
          required: true
          description: Quick check to see if a username exists when changing names
          schema:
            $ref: "#/components/schemas/Username"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: A boolean indicating if the username exists
          content:
            application/json:
              schema:
                type: boolean
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /profiles/view:
    get:
      summary: "View a specific user profile"
      parameters:
        - name: id
          in: query
          required: true
          description: View a specific user profile and their stats
          schema:
            $ref: "#/components/schemas/ID"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Stats and profile fetched successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProfileWithStats"

        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /wordlists/default:
    get:
      summary: "View default wordlists"
      responses:
        "200":
          description: Default wordlists fetched successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Wordlist"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "429":
          $ref: "#/components/responses/TooManyRequests"
  /wordlists/search:
    get:
      summary: "Search for wordlists"
      security:
        - bearerAuth: []
      parameters:
        - name: q
          in: query
          required: true
          description: Search query
          schema:
            $ref: "#/components/schemas/Username"
        - name: limit
          in: query
          description: Maximum number of results to return
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
          example: 10
        - name: page
          in: query
          description: Get the page to return
          schema:
            type: integer
            minimum: 1
            default: 1
          example: 2
      responses:
        "200":
          description: wordlists fetched successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Wordlist"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /wordlists/me:
    get:
      summary: "Wordlists of the auth user"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Wordlists fetched successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Wordlist"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "429":
          $ref: "#/components/responses/TooManyRequests"
    put:
      summary: Added wordlist for the authenticated user
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Wordlist"
      responses:
        "201":
          description: Wordlist added successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Wordlist"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Wordlist with that name already exists
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    patch:
      summary: Updated authenticated users wordlist
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - type: object
                  description: Wordlists for a game
                  required:
                    - id
                  properties:
                    id:
                      $ref: "#/components/schemas/ID"
                    name:
                      type: string
                      example: "@3.,wordlist"
                    words:
                      $ref: "#/components/schemas/Words"
                    is_public:
                      type: boolean
                - anyOf:
                    - required: [name]
                    - required: [words]
                    - required: [is_public]

      responses:
        "200":
          description: Wordlist updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Wordlist"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Wordlist with that name already exists or is public
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "429":
          $ref: "#/components/responses/TooManyRequests"
    delete:
      summary: Delete a wordlist by id
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: query
          required: true
          description: Wordlist ID to delete
          schema:
            $ref: "#/components/schemas/ID"
      responses:
        "204":
          description: Wordlist deleted successfully
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /relations/me:
    get:
      summary: "Relations of the authenticated user"
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Relations fetched successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Request"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /relations/request:
    post:
      summary: Establish relation with another user
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: query
          required: true
          description: ID of the authenticated user to send request to
          schema:
            $ref: "#/components/schemas/ID"
      responses:
        "201":
          description: Request sent successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Request"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: You've sent a request to the user recently, please wait some time before sending another request
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Error"
                  - type: object
                    properties:
                      last_request:
                        description: Date when relation was requested
                        $ref: "#/components/schemas/DateTime"

    delete:
      summary: Cancel a request
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: query
          required: true
          description: Request ID to delete
          schema:
            $ref: "#/components/schemas/ID"
      responses:
        "204":
          description: Request cancelled successfully
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "429":
          $ref: "#/components/responses/TooManyRequests"

  /relations/respond:
    post:
      summary: Accept a relation request by another user
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: query
          required: true
          description: ID of the relation to accept
          schema:
            $ref: "#/components/schemas/ID"
      responses:
        "201":
          description: Request sent successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Request"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      summary: Cancel a request
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: query
          required: true
          description: Request ID to delete
          schema:
            $ref: "#/components/schemas/ID"
      responses:
        "204":
          description: Request cancelled successfully
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "429":
          $ref: "#/components/responses/TooManyRequests"
